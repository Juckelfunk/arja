# Post-Processing Tool 
This tool assumes that the buggy program can still function perfectly on 
the test inputs encoded in the positive test cases so
that with these inputs, the patched program should obtain
the same outputs as the buggy program.

The input of this tool includes:
1. the buggy program 
2. the associated test suite
3. a patch generated by the diff utility

This tool will output whether the patch is correct or not, and it
will also output a semantic distance (between 0 and 1, smaller is better), 
which measures how close the method outputs obtained by the patched program are to the expected
outputs.
This semantic distance can be used in the ranking of the patches. 



## Requirements
1. Java JDK 1.7
2. Mac OS X or Linux


## How to Run

### Set Up

First, clone ARJA-e system to the local computer:
```
$ git clone https://github.com/ywmsu/arja-e
```
Then the root directory of this tool is:
```
../arja-e/post-tool
```
There are three subdirectories in the root directory of this tool:
1. ../arja-e/post-tool/src :  the source code of the tool
2. ../arja-e/post-tool/lib :  the dependences of the tool (including a number of .jar files)
3. ../arja-e/post-tool/dataset :  this is the dataset of patches used for patch overfitting detection, and 
it includes 122 patches (97 incorrect and 25 correct) generated by three repair systems, i.e., ARJA-e, GenProg and Kali. 



### Build
The users should compile the tool first. Enter into the root directory of the tool:
```
$ cd post-tool
```

Then, compile the source code of the tool, and the compiled classes should be saved in the directory "bin":
```
$ mkdir bin
$ javac -cp lib/*: -d bin $(find src -name '*.java')
```


### Usage
Enter into the root directory of the tool:
```
$ cd post-tool
```
Confirm that the current version of Java is JDK 1.7 and use the following command to run:
```
$ java -cp lib/*:bin detection.Main -DsrcJavaDir path_to_directory_of_src_buggy \
				-DbinJavaDir path_to_directory_of_binary_source_buggy \
				-DbinTestDir path_to_directory_of_binary_test_buggy  \
				-Ddependences paths_to_dependences_buggy \
				-DpatchPath path_to_patch_file
```
It requires five parameters related to the buggy program, which are explained as follows:
1. -DsrcJavaDir  :  the path to the root directory of the source code 
2. -DbinJavaDir  : the path to the root directory of all the compiled classes of source code
3. -DbinTestDir  :  the path to the root directory of all the compiled classes of test code
4. -Ddependences :  the paths to the the dependences (jar files). If more than one, separated by ":"
5. -DpatchPath : the path to a patch file that is generated by the command "diff -u ..."

Before running this tool, the user should make sure that the patch is 
really generated from the source code of the buggy program, and 
it can be successfully applied to the buggy program. For all the paths, the absolute paths should 
be used. 

The user can use the following command to list all the parameters for this tool:
```
$ java -cp lib/*:bin detection.Main -listParameters
```

## Evaluation 

This tool has been evaluated on the patches collected in the folder "dataset". The results indicated 
that, among the 97 incorrect patches and 25 correct patches, this tool can successfully identify 48 incorrect 
patches and only exclude 3 correct patches by mistake. 
 
